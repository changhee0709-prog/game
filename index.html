<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠˆí¼ ì–´ë¦°ì´ ê²Œì„ ì²œêµ­ (ìµœì¢… ì™„ì„±ë³¸)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        
        body { font-family: 'Jua', sans-serif; text-align: center; background-color: #e0f7fa; margin: 0; padding: 0; user-select: none; overflow: hidden; }
        
        /* ê³µí†µ ìœ í‹¸ë¦¬í‹° */
        .hidden { display: none !important; }
        .screen { width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        
        /* ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        button { font-family: 'Jua', sans-serif; cursor: pointer; border: none; outline: none; }
        
        .big-btn {
            font-size: 2rem; padding: 15px 40px; border-radius: 50px;
            background: linear-gradient(to bottom, #ffeb3b, #fbc02d); color: #d84315;
            box-shadow: 0 6px #f57f17; margin-top: 20px;
        }
        .big-btn:active { transform: translateY(6px); box-shadow: 0 0 #f57f17; }
        
        .menu-btn {
            width: 280px; height: 70px; font-size: 1.5rem; margin: 10px;
            border-radius: 20px; color: white;
            box-shadow: 0 5px rgba(0,0,0,0.2); transition: transform 0.1s;
        }
        .btn-card { background-color: #4CAF50; }
        .btn-dino { background-color: #2196F3; }
        .btn-stack { background-color: #9C27B0; }
        .menu-btn:active { transform: scale(0.95); }

        /* ê¸°ë¡ ì‚­ì œ ë²„íŠ¼ */
        .btn-clear { background-color: #9e9e9e; color: white; padding: 5px 15px; border-radius: 10px; font-size: 0.9rem; margin-top: 30px; opacity: 0.7; }

        /* ê²Œì„ ìƒë‹¨ ë°” */
        #game-header {
            position: absolute; top: 10px; width: 95%;
            display: flex; justify-content: space-between; align-items: center;
            z-index: 10;
        }
        #score-panel {
            font-size: 1.5rem; color: #333; background: rgba(255,255,255,0.8);
            padding: 5px 15px; border-radius: 20px; font-weight: bold;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .btn-quit {
            background-color: #ff5252; color: white; font-size: 1.2rem;
            padding: 8px 15px; border-radius: 15px; box-shadow: 0 3px #d32f2f;
        }
        .btn-quit:active { transform: translateY(3px); box-shadow: none; }

        /* ìº”ë²„ìŠ¤ ë° ê·¸ë¦¬ë“œ */
        canvas { border: 4px solid #333; border-radius: 15px; background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.2); touch-action: none; margin-top: 50px; }
        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 50px; }
        .card {
            width: 70px; height: 70px; background-color: #FF5722; border-radius: 10px;
            display: flex; align-items: center; justify-content: center; font-size: 2.5rem;
            box-shadow: 0 4px #E64A19;
        }
        .card.flipped { background-color: #fff; border: 2px solid #FF5722; cursor: default; }

        /* ì´ë¦„ ë²„íŠ¼ ê·¸ë£¹ */
        .name-btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .name-btn { font-size: 1.2rem; padding: 10px; border-radius: 15px; color: white; box-shadow: 0 3px rgba(0,0,0,0.2); }
        .nb-1 { background-color: #2196F3; } 
        .nb-2 { background-color: #E91E63; } 
        .nb-3 { background-color: #FF9800; } 
        .nb-4 { background-color: #4CAF50; } 

        /* íŒì—… ëª¨ë‹¬ */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.7); z-index: 100;
            display: flex; justify-content: center; align-items: center;
        }
        .modal-box {
            background: white; padding: 20px; border-radius: 20px; width: 340px;
            text-align: center; border: 5px solid #FFC107;
        }
        .rank-list { text-align: left; background: #f9f9f9; padding: 10px; border-radius: 10px; margin: 10px 0; max-height: 120px; overflow-y: auto; }
        .rank-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; font-size: 0.9rem; }
        .control-btn { padding: 10px 20px; margin: 5px; border-radius: 10px; font-size: 1.1rem; color: white; }
        .btn-restart { background-color: #ff9800; }
        .btn-home { background-color: #9E9E9E; }
        .hit-effect { animation: shake 0.4s; }
        @keyframes shake { 0% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } 100% { transform: translateX(0); } }

    </style>
</head>
<body>

    <div id="intro-screen" class="screen">
        <h1 style="font-size: 3.5rem; color:white; text-shadow:3px 3px 0 #333;">ğŸ® ê²Œì„ ì²œêµ­ ğŸ®</h1>
        <button class="big-btn" onclick="enterFullScreen()">ê²Œì„ ì‹œì‘!</button>
    </div>

    <div id="main-menu" class="screen hidden">
        <h2 style="font-size: 2rem;">ì–´ë–¤ ê²Œì„ì„ í• ê¹Œ?</h2>
        <button class="menu-btn btn-card" onclick="startGame(1)">ğŸ¶ ì§ê¿ ì¹´ë“œ ì°¾ê¸°</button>
        <button class="menu-btn btn-dino" onclick="startGame(2)">ğŸ¦– ê³µë£¡ ëŒ€ëª¨í—˜</button>
        <button class="menu-btn btn-stack" onclick="startGame(3)">ğŸŒˆ ë¬´ì§€ê°œ íƒ‘ ìŒ“ê¸°</button>
        <button class="btn-clear" onclick="clearAllRecords()">ê¸°ë¡ ì´ˆê¸°í™”</button>
    </div>

    <div id="game-screen" class="screen hidden">
        <div id="game-header">
            <button class="btn-quit" onclick="goHome()">ğŸš« ê·¸ë§Œí•˜ê¸°</button>
            <div id="score-panel">
                <span id="score-display">0ì </span>
                <span id="lives-display" class="hidden" style="margin-left:10px;">â¤ï¸â¤ï¸â¤ï¸</span>
            </div>
        </div>
        <div id="game-area"></div>
    </div>

    <div id="modal-overlay" class="hidden">
        <div class="modal-box">
            <h2 id="modal-title">ê²Œì„ ë!</h2>
            <p id="final-score" style="font-size: 1.8rem; font-weight: bold; color: #2196F3;">0ì </p>
            <div id="new-record-area" class="hidden">
                <p style="color: #FF9800; margin:0;">ğŸ‰ ë©‹ì ¸ìš”! ëˆ„ê°€ í–ˆë‚˜ìš”? ğŸ‰</p>
                <div class="name-btn-group">
                    <button class="name-btn nb-1" onclick="saveRecord('ğŸ‘¨ ì•„ë¹ ')">ğŸ‘¨ ì•„ë¹ </button>
                    <button class="name-btn nb-2" onclick="saveRecord('ğŸ‘© ì—„ë§ˆ')">ğŸ‘© ì—„ë§ˆ</button>
                    <button class="name-btn nb-3" onclick="saveRecord('ğŸ‘§ ë‹¤ì˜ˆ')">ğŸ‘§ ë‹¤ì˜ˆ</button>
                    <button class="name-btn nb-4" onclick="saveRecord('ğŸ‘¦ ê°€ëŒ')">ğŸ‘¦ ê°€ëŒ</button>
                </div>
            </div>
            <div class="rank-list" id="rank-display"></div>
            <div style="margin-top: 10px;">
                <button class="control-btn btn-restart" onclick="restartGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
                <button class="control-btn btn-home" onclick="goHome()">ğŸ  ë©”ë‰´ë¡œ</button>
            </div>
        </div>
    </div>

    <script>
        let currentGameId = 0, score = 0, gameInterval = null, isGameOver = false, lives = 5;
        const STORAGE_KEYS = { 1: 'rk_card_v3', 2: 'rk_dino_v3', 3: 'rk_stack_v3' };

        function enterFullScreen() {
            document.documentElement.requestFullscreen().catch(() => {});
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }

        function goHome() {
            clearInterval(gameInterval); isGameOver = true;
            document.getElementById('modal-overlay').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }

        function restartGame() {
            document.getElementById('modal-overlay').classList.add('hidden');
            startGame(currentGameId);
        }

        function startGame(id) {
            currentGameId = id; score = 0; lives = 5; isGameOver = false;
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-area').innerHTML = ''; 
            updateScoreUI();
            if (id === 1) initCardGame();
            if (id === 2) initDinoGame();
            if (id === 3) initStackGame();
        }

        function updateScoreUI() { document.getElementById('score-display').innerText = `${score}ì `; }
        function getRanks(id) { return JSON.parse(localStorage.getItem(STORAGE_KEYS[id])) || []; }

        function clearAllRecords() {
            if(confirm("ì •ë§ ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì§€ìš¸ê¹Œìš”?")) {
                localStorage.removeItem(STORAGE_KEYS[1]);
                localStorage.removeItem(STORAGE_KEYS[2]);
                localStorage.removeItem(STORAGE_KEYS[3]);
                alert("ê¸°ë¡ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤!");
            }
        }

        function showGameOverModal() {
            isGameOver = true; clearInterval(gameInterval);
            const modal = document.getElementById('modal-overlay');
            const ranks = getRanks(currentGameId);
            document.getElementById('final-score').innerText = `${score}ì `;
            modal.classList.remove('hidden');
            if (ranks.length < 5 || score > ranks[ranks.length - 1].score) {
                document.getElementById('new-record-area').classList.remove('hidden');
            } else {
                document.getElementById('new-record-area').classList.add('hidden');
            }
            renderRanks(ranks);
        }

        function renderRanks(ranks) {
            let html = '';
            ranks.forEach((r, i) => {
                html += `<div class="rank-item"><span>${i+1}. ${r.name}</span><span>${r.score}ì </span></div>`;
            });
            document.getElementById('rank-display').innerHTML = html || '<p>ê¸°ë¡ì´ ì—†ì–´ìš”!</p>';
        }

        function saveRecord(playerName) {
            const now = new Date();
            const displayName = `${playerName} (${now.getMonth()+1}/${now.getDate()})`;
            const ranks = getRanks(currentGameId);
            ranks.push({ name: displayName, score: score });
            ranks.sort((a, b) => b.score - a.score);
            localStorage.setItem(STORAGE_KEYS[currentGameId], JSON.stringify(ranks.slice(0, 5)));
            document.getElementById('new-record-area').classList.add('hidden');
            renderRanks(getRanks(currentGameId));
        }

        // [ê²Œì„ 1] ğŸ¶ ì¹´ë“œ ì°¾ê¸°
        function initCardGame() {
            document.getElementById('lives-display').classList.add('hidden');
            const container = document.getElementById('game-area');
            let emojis = ['ğŸ¶','ğŸ¶','ğŸ±','ğŸ±','ğŸ­','ğŸ­','ğŸ¹','ğŸ¹','ğŸ°','ğŸ°','ğŸ¦Š','ğŸ¦Š','ğŸ¸','ğŸ¸','ğŸ¼','ğŸ¼'];
            emojis.sort(() => Math.random() - 0.5);
            let grid = document.createElement('div'), selected = [], matches = 0;
            grid.className = 'grid';
            emojis.forEach(emoji => {
                let card = document.createElement('div');
                card.className = 'card'; card.innerHTML = '<span>?</span>';
                card.onclick = () => {
                    if (isGameOver || selected.length >= 2 || card.classList.contains('flipped')) return;
                    card.classList.add('flipped'); card.innerHTML = `<span>${emoji}</span>`;
                    selected.push(card);
                    if (selected.length === 2) {
                        if (selected[0].innerHTML === selected[1].innerHTML) {
                            score += 100; matches++; selected = []; updateScoreUI();
                            if (matches === 8) setTimeout(showGameOverModal, 500);
                        } else {
                            score = Math.max(0, score - 10); updateScoreUI();
                            setTimeout(() => { selected.forEach(c => { c.classList.remove('flipped'); c.innerHTML = '<span>?</span>'; }); selected = []; }, 800);
                        }
                    }
                };
                grid.appendChild(card);
            });
            container.appendChild(grid);
        }

        // [ê²Œì„ 2] ğŸ¦– ê³µë£¡ ëŒ€ëª¨í—˜ (êµ¬ë© ì¸ì‹ ë¡œì§ ìˆ˜ì •)
        function initDinoGame() {
            const livesDisplay = document.getElementById('lives-display');
            livesDisplay.classList.remove('hidden');
            const container = document.getElementById('game-area');
            const canvas = document.createElement('canvas');
            canvas.width = 340; canvas.height = 240;
            container.appendChild(canvas);
            const ctx = canvas.getContext('2d');

            let dino = { x: 50, y: 160, w: 30, h: 30, dy: 0, grounded: true };
            let obstacles = [], pits = [], frame = 0, invincibility = 0;

            const jump = () => { if (dino.grounded) { dino.dy = -11; dino.grounded = false; } };
            canvas.addEventListener('mousedown', jump);
            canvas.addEventListener('touchstart', e => { e.preventDefault(); jump(); });

            function updateLivesUI() {
                let h = ""; for(let i=0; i<lives; i++) h += "â¤ï¸";
                livesDisplay.innerText = h;
            }
            updateLivesUI();

            function loop() {
                if (isGameOver) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);

                if (frame % 120 === 0) pits.push({ x: 340, w: 60 });
                if (frame % 90 === 0) {
                    let onPitZone = pits.some(p => p.x > 300);
                    if(!onPitZone) obstacles.push({ x: 340, w: 20, h: 30 });
                }

                // ë°”ë‹¥ ê·¸ë¦¬ê¸°
                ctx.fillStyle = '#795548'; ctx.fillRect(0, 190, 340, 50);
                ctx.fillStyle = '#fff'; 
                let isAbovePit = false;
                pits.forEach((p, i) => {
                    p.x -= 4; ctx.fillRect(p.x, 190, p.w, 50);
                    if (dino.x + 10 < p.x + p.w && dino.x + 20 > p.x) isAbovePit = true;
                    if (p.x + p.w < 0) pits.splice(i, 1);
                });

                // ê³µë£¡ ë¬¼ë¦¬ ë¡œì§
                dino.dy += 0.6; dino.y += dino.dy;

                if (dino.y >= 160) {
                    if (isAbovePit) {
                        dino.grounded = false; // êµ¬ë©ì´ë©´ í†µê³¼
                        if (dino.y > 280) { // êµ¬ë©ì— ë¹ ì¡Œì„ ë•Œ
                            score = Math.max(0, score - 10); updateScoreUI();
                            dino.y = -50; dino.dy = 0; invincibility = 90;
                        }
                    } else {
                        if (dino.y < 200) { // ë°”ë‹¥ ì•ˆì°©
                            dino.y = 160; dino.dy = 0; dino.grounded = true;
                        }
                    }
                }

                // ê³µë£¡ ê·¸ë¦¬ê¸°
                ctx.fillStyle = (invincibility > 0 && Math.floor(frame/5)%2) ? 'transparent' : '#4CAF50';
                ctx.fillRect(dino.x, dino.y, 30, 30);
                ctx.fillRect(dino.x+15, dino.y-10, 20, 20); // ë¨¸ë¦¬
                ctx.fillStyle='black'; ctx.fillRect(dino.x+25, dino.y-5, 4, 4);

                // ì¥ì• ë¬¼
                ctx.fillStyle = '#e91e63';
                obstacles.forEach((obs, i) => {
                    obs.x -= 4; ctx.fillRect(obs.x, 160, obs.w, obs.h);
                    if (invincibility <= 0 && dino.x < obs.x+obs.w && dino.x+30 > obs.x && dino.y < 160+obs.h && dino.y+30 > 160) {
                        lives--; updateLivesUI(); invincibility = 60;
                        container.classList.add('hit-effect'); setTimeout(() => container.classList.remove('hit-effect'), 400);
                        if (lives <= 0) showGameOverModal();
                    }
                    if (obs.x + obs.w < 0) { obstacles.splice(i, 1); score += 10; updateScoreUI(); }
                });

                if (invincibility > 0) invincibility--;
                frame++; gameInterval = requestAnimationFrame(loop);
            }
            loop();
        }

        // [ê²Œì„ 3] ğŸŒˆ íƒ‘ ìŒ“ê¸°
        function initStackGame() {
            document.getElementById('lives-display').classList.add('hidden');
            const container = document.getElementById('game-area'), canvas = document.createElement('canvas');
            canvas.width = 300; canvas.height = 400; container.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let stack = [{ x: 75, w: 150, y: 370, color: '#333' }], curW = 150, curX = 0, speed = 3, dir = 1, layer = 0, startY = 370;
            function draw() {
                if (isGameOver) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                stack.forEach(b => { ctx.fillStyle = b.color; ctx.fillRect(b.x, b.y, b.w, 30); });
                ctx.fillStyle = `hsl(${(layer * 40) % 360}, 80%, 60%)`;
                ctx.fillRect(curX, startY - (layer + 1) * 30, curW, 30);
                curX += speed * dir; if (curX + curW > 300 || curX < 0) dir *= -1;
                gameInterval = requestAnimationFrame(draw);
            }
            const place = (e) => {
                if(e.type==='touchstart') e.preventDefault();
                let prev = stack[stack.length-1];
                let overlap = Math.min(prev.x + prev.w, curX + curW) - Math.max(prev.x, curX);
                if (overlap > 0) {
                    let newX = Math.max(prev.x, curX);
                    stack.push({ x: newX, w: overlap, y: startY - (layer + 1) * 30, color: `hsl(${(layer * 40) % 360}, 80%, 60%)` });
                    curW = overlap; layer++; score = layer * 10; updateScoreUI();
                    if (layer > 7) { stack.forEach(b => b.y += 30); startY += 30; stack.shift(); }
                    speed += 0.2; curX = Math.random() > 0.5 ? 0 : 300 - curW;
                } else { showGameOverModal(); }
            };
            canvas.addEventListener('mousedown', place); canvas.addEventListener('touchstart', place);
            draw();
        }
    </script>
</body>
</html>