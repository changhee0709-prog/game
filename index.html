<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ìŠˆí¼ ì–´ë¦°ì´ ê²Œì„ ì²œêµ­ (ê°€ëŒì´ ì»¤ìŠ¤í…€)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Jua&display=swap');
        
        body { font-family: 'Jua', sans-serif; text-align: center; background-color: #e0f7fa; margin: 0; padding: 0; user-select: none; overflow: hidden; }
        .hidden { display: none !important; }
        .screen { width: 100%; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; position: relative; }
        
        button { font-family: 'Jua', sans-serif; cursor: pointer; border: none; outline: none; }
        .big-btn { font-size: 2.2rem; padding: 15px 50px; border-radius: 50px; background: linear-gradient(to bottom, #ffeb3b, #fbc02d); color: #d84315; box-shadow: 0 6px #f57f17; margin-top: 20px; }
        
        /* ë©”ì¸ ë©”ë‰´ ë²„íŠ¼ë“¤ */
        .menu-btn { width: 280px; height: 60px; font-size: 1.4rem; margin: 8px; border-radius: 20px; color: white; box-shadow: 0 5px rgba(0,0,0,0.2); transition: transform 0.1s; }
        .btn-card { background-color: #4CAF50; }
        .btn-dino { background-color: #2196F3; }
        .btn-stack { background-color: #9C27B0; }
        .btn-balloon { background-color: #E91E63; }
        
        .score-view-btn { width: 280px; height: 50px; background-color: #FF9800; color: white; border-radius: 20px; font-size: 1.2rem; margin-top: 20px; box-shadow: 0 4px #e68a00; }

        #game-header { position: absolute; top: 10px; width: 95%; display: flex; justify-content: space-between; align-items: center; z-index: 10; }
        #score-panel { font-size: 1.4rem; color: #333; background: rgba(255,255,255,0.8); padding: 5px 15px; border-radius: 20px; font-weight: bold; }
        .btn-quit { background-color: #ff5252; color: white; font-size: 1.1rem; padding: 8px 15px; border-radius: 15px; box-shadow: 0 3px #d32f2f; }

        canvas { border: 4px solid #333; border-radius: 15px; background: white; box-shadow: 0 10px 20px rgba(0,0,0,0.2); touch-action: none; margin-top: 40px; }
        
        /* íŒì—… ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        #modal-overlay, #score-modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 100; display: flex; justify-content: center; align-items: center; }
        .modal-box { background: white; padding: 20px; border-radius: 20px; width: 340px; text-align: center; border: 5px solid #FFC107; max-height: 85vh; overflow-y: auto; }
        
        .rank-list { text-align: left; background: #f9f9f9; padding: 10px; border-radius: 10px; margin: 10px 0; max-height: 120px; overflow-y: auto; }
        .rank-item { display: flex; justify-content: space-between; border-bottom: 1px solid #eee; padding: 5px 0; font-size: 0.9rem; }
        
        .name-btn-group { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 15px 0; }
        .name-btn { font-size: 1.2rem; padding: 10px; border-radius: 15px; color: white; }
        .nb-1 { background-color: #2196F3; } .nb-2 { background-color: #E91E63; } .nb-3 { background-color: #FF9800; } .nb-4 { background-color: #f06292; } /* í•‘í¬ìƒ‰ ê³„ì—´ë¡œ ë³€ê²½ */

        .grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-top: 50px; }
        .card { width: 70px; height: 70px; background-color: #FF5722; border-radius: 10px; display: flex; align-items: center; justify-content: center; font-size: 2.5rem; }

        /* ì „ì²´ ê¸°ë¡ íŒì—…ìš© */
        .all-scores-title { font-size: 1.1rem; background: #eee; padding: 5px; border-radius: 10px; margin-top: 15px; display: block; color: #333; }
    </style>
</head>
<body>

    <!-- 1. ì‹œì‘ í™”ë©´ -->
    <div id="intro-screen" class="screen">
        <h1 style="font-size: 3.5rem; color:white; text-shadow:3px 3px 0 #333;">ğŸ® ê²Œì„ ì²œêµ­ ğŸ®</h1>
        <button class="big-btn" onclick="enterFullScreen()">ê²Œì„ ì‹œì‘!</button>
    </div>

    <!-- 2. ë©”ì¸ ë©”ë‰´ -->
    <div id="main-menu" class="screen hidden">
        <h2 style="font-size: 1.8rem; margin-bottom: 10px;">ì–´ë–¤ ê²Œì„ì„ í• ê¹Œìš”?</h2>
        <button class="menu-btn btn-card" onclick="startGame(1)">ğŸ¶ ì§ê¿ ì¹´ë“œ ì°¾ê¸°</button>
        <button class="menu-btn btn-dino" onclick="startGame(2)">ğŸ¦– ê³µë£¡ ëŒ€ëª¨í—˜</button>
        <button class="menu-btn btn-stack" onclick="startGame(3)">ğŸŒˆ ë¬´ì§€ê°œ íƒ‘ ìŒ“ê¸°</button>
        <button class="menu-btn btn-balloon" onclick="startGame(4)">ğŸˆ í’ì„  íŒ¡íŒ¡ (60ì´ˆ)</button>
        
        <button class="score-view-btn" onclick="showAllScores()">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ (ê¸°ë¡ ë³´ê¸°)</button>
        
        <button style="margin-top:20px; opacity:0.5; font-size:0.8rem;" onclick="clearAllRecords()">ê¸°ë¡ ì´ˆê¸°í™”</button>
    </div>

    <!-- 3. ê²Œì„ í”Œë ˆì´ í™”ë©´ -->
    <div id="game-screen" class="screen hidden">
        <div id="game-header">
            <button class="btn-quit" onclick="goHome()">ğŸš« ê·¸ë§Œí•˜ê¸°</button>
            <div id="score-panel">
                <span id="timer-display" class="hidden" style="color:red; margin-right:10px;">60s</span>
                <span id="score-display">0ì </span>
                <span id="lives-display" class="hidden" style="margin-left:10px;"></span>
            </div>
        </div>
        <div id="game-area"></div>
    </div>

    <!-- 4. ê°œë³„ ê²Œì„ ì¢…ë£Œ íŒì—… -->
    <div id="modal-overlay" class="hidden">
        <div class="modal-box">
            <h2 id="modal-title">ê²Œì„ ë!</h2>
            <p id="final-score" style="font-size: 2rem; font-weight: bold; color: #2196F3;">0ì </p>
            <div id="new-record-area" class="hidden">
                <p style="color: #FF9800; margin:0;">ğŸ‰ ëˆ„ê°€ ê¸°ë¡ì„ ì„¸ì› ë‚˜ìš”? ğŸ‰</p>
                <div class="name-btn-group">
                    <button class="name-btn nb-1" onclick="saveRecord('ğŸ‘¨ ì•„ë¹ ')">ğŸ‘¨ ì•„ë¹ </button>
                    <button class="name-btn nb-2" onclick="saveRecord('ğŸ‘© ì—„ë§ˆ')">ğŸ‘© ì—„ë§ˆ</button>
                    <button class="name-btn nb-3" onclick="saveRecord('ğŸ‘§ ë‹¤ì˜ˆ')">ğŸ‘§ ë‹¤ì˜ˆ</button>
                    <button class="name-btn nb-4" onclick="saveRecord('ğŸ‘§ ê°€ëŒ')">ğŸ‘§ ê°€ëŒ</button>
                </div>
            </div>
            <div class="rank-list" id="rank-display"></div>
            <div style="margin-top: 15px;">
                <button style="padding:10px 20px; background:#ff9800; color:white; border-radius:10px;" onclick="restartGame()">ğŸ”„ ë‹¤ì‹œ í•˜ê¸°</button>
                <button style="padding:10px 20px; background:#9e9e9e; color:white; border-radius:10px;" onclick="goHome()">ğŸ  ë©”ë‰´ë¡œ</button>
            </div>
        </div>
    </div>

    <!-- 5. ì „ì²´ ê¸°ë¡ ë³´ê¸° íŒì—… -->
    <div id="score-modal-overlay" class="hidden">
        <div class="modal-box">
            <h2 style="color: #FF9800;">ğŸ† ëª…ì˜ˆì˜ ì „ë‹¹ ğŸ†</h2>
            <div id="all-ranks-content">
                <!-- ì—¬ê¸°ì— ëª¨ë“  ê²Œì„ì˜ ìˆœìœ„ê°€ ë“¤ì–´ê° -->
            </div>
            <button style="margin-top: 20px; padding:10px 40px; background:#9e9e9e; color:white; border-radius:10px;" onclick="closeAllScores()">ë‹«ê¸°</button>
        </div>
    </div>

    <script>
        let currentGameId = 0, score = 0, gameInterval = null, isGameOver = false, lives = 5, timeLeft = 60, timerId = null;
        const STORAGE_KEYS = { 1: 'rk_card_v4', 2: 'rk_dino_v4', 3: 'rk_stack_v4', 4: 'rk_balloon_v4' };
        const GAME_NAMES = { 1: 'ğŸ¶ ì¹´ë“œ ì°¾ê¸°', 2: 'ğŸ¦– ê³µë£¡ ëŒ€ëª¨í—˜', 3: 'ğŸŒˆ ë¬´ì§€ê°œ íƒ‘', 4: 'ğŸˆ í’ì„  íŒ¡íŒ¡' };

        function enterFullScreen() {
            document.documentElement.requestFullscreen().catch(() => {});
            document.getElementById('intro-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
        }

        function goHome() {
            clearInterval(gameInterval); clearInterval(timerId); isGameOver = true;
            document.getElementById('modal-overlay').classList.add('hidden');
            document.getElementById('score-modal-overlay').classList.add('hidden');
            document.getElementById('game-screen').classList.add('hidden');
            document.getElementById('main-menu').classList.remove('hidden');
            document.getElementById('timer-display').classList.add('hidden');
        }

        function restartGame() {
            document.getElementById('modal-overlay').classList.add('hidden');
            startGame(currentGameId);
        }

        function startGame(id) {
            currentGameId = id; score = 0; lives = 5; timeLeft = 60; isGameOver = false;
            document.getElementById('main-menu').classList.add('hidden');
            document.getElementById('game-screen').classList.remove('hidden');
            document.getElementById('game-area').innerHTML = ''; 
            document.getElementById('lives-display').classList.add('hidden');
            document.getElementById('timer-display').classList.add('hidden');
            updateScoreUI();
            
            if (id === 1) initCardGame();
            if (id === 2) initDinoGame();
            if (id === 3) initStackGame();
            if (id === 4) initBalloonGame();
        }

        function updateScoreUI() { document.getElementById('score-display').innerText = `${score}ì `; }
        function getRanks(id) { return JSON.parse(localStorage.getItem(STORAGE_KEYS[id])) || []; }

        function clearAllRecords() {
            if(confirm("ëª¨ë“  ê²Œì„ ê¸°ë¡ì„ ì´ˆê¸°í™”í• ê¹Œìš”?")) {
                Object.values(STORAGE_KEYS).forEach(k => localStorage.removeItem(k));
                alert("ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.");
            }
        }

        function showAllScores() {
            const container = document.getElementById('all-ranks-content');
            container.innerHTML = '';
            [1, 2, 3, 4].forEach(id => {
                const title = document.createElement('b'); title.className = 'all-scores-title';
                title.innerText = GAME_NAMES[id]; container.appendChild(title);
                const list = document.createElement('div'); list.className = 'rank-list';
                const ranks = getRanks(id);
                if(ranks.length === 0) list.innerHTML = '<div style="text-align:center; font-size:0.8rem; color:#999;">ê¸°ë¡ì´ ì—†ì–´ìš”</div>';
                else ranks.forEach((r, i) => list.innerHTML += `<div class="rank-item"><span>${i+1}. ${r.name}</span><span>${r.score}ì </span></div>`);
                container.appendChild(list);
            });
            document.getElementById('score-modal-overlay').classList.remove('hidden');
        }

        function closeAllScores() { document.getElementById('score-modal-overlay').classList.add('hidden'); }

        function showGameOverModal() {
            isGameOver = true; clearInterval(gameInterval); clearInterval(timerId);
            document.getElementById('modal-overlay').classList.remove('hidden');
            document.getElementById('final-score').innerText = `${score}ì `;
            const ranks = getRanks(currentGameId);
            if (ranks.length < 5 || score > (ranks[ranks.length - 1]?.score || 0)) {
                document.getElementById('new-record-area').classList.remove('hidden');
            } else {
                document.getElementById('new-record-area').classList.add('hidden');
            }
            renderRanks(ranks);
        }

        function renderRanks(ranks) {
            let html = '';
            ranks.forEach((r, i) => html += `<div class="rank-item"><span>${i+1}. ${r.name}</span><span>${r.score}ì </span></div>`);
            document.getElementById('rank-display').innerHTML = html || '<p>ì²« ê¸°ë¡ì„ ë‚¨ê²¨ë³´ì„¸ìš”!</p>';
        }

        function saveRecord(name) {
            const now = new Date();
            const displayName = `${name} (${now.getMonth()+1}/${now.getDate()})`;
            const ranks = getRanks(currentGameId);
            ranks.push({ name: displayName, score: score });
            ranks.sort((a, b) => b.score - a.score);
            localStorage.setItem(STORAGE_KEYS[currentGameId], JSON.stringify(ranks.slice(0, 5)));
            document.getElementById('new-record-area').classList.add('hidden');
            renderRanks(getRanks(currentGameId));
        }

        // [ê²Œì„ 1] ğŸ¶ ì¹´ë“œ ì°¾ê¸°
        function initCardGame() {
            const area = document.getElementById('game-area');
            let emojis = ['ğŸ¶','ğŸ¶','ğŸ±','ğŸ±','ğŸ­','ğŸ­','ğŸ¹','ğŸ¹','ğŸ°','ğŸ°','ğŸ¦Š','ğŸ¦Š','ğŸ¸','ğŸ¸','ğŸ¼','ğŸ¼'];
            emojis.sort(() => Math.random() - 0.5);
            let grid = document.createElement('div'), selected = [], matches = 0;
            grid.className = 'grid';
            emojis.forEach(emoji => {
                let card = document.createElement('div'); card.className = 'card'; card.innerHTML = '<span>?</span>';
                card.onclick = () => {
                    if (isGameOver || selected.length >= 2 || card.classList.contains('flipped')) return;
                    card.classList.add('flipped'); card.innerHTML = `<span>${emoji}</span>`;
                    selected.push(card);
                    if (selected.length === 2) {
                        if (selected[0].innerHTML === selected[1].innerHTML) {
                            score += 100; matches++; selected = []; updateScoreUI();
                            if (matches === 8) setTimeout(showGameOverModal, 500);
                        } else {
                            score = Math.max(0, score - 10); updateScoreUI();
                            setTimeout(() => { selected.forEach(c => { c.classList.remove('flipped'); c.innerHTML = '<span>?</span>'; }); selected = []; }, 800);
                        }
                    }
                };
                grid.appendChild(card);
            });
            area.appendChild(grid);
        }

        // [ê²Œì„ 2] ğŸ¦– ê³µë£¡ ëŒ€ëª¨í—˜ (ê¸°ì¡´ ê³µë£¡ ìœ ì§€)
        function initDinoGame() {
            const ld = document.getElementById('lives-display'); ld.classList.remove('hidden');
            const area = document.getElementById('game-area');
            const canvas = document.createElement('canvas'); canvas.width = 340; canvas.height = 240; area.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let dino = { x: 50, y: 160, w: 30, h: 30, dy: 0, grounded: true }, obstacles = [], pits = [], frame = 0, inv = 0;
            const jump = () => { if(dino.grounded) { dino.dy = -11; dino.grounded = false; } };
            canvas.onmousedown = jump; canvas.ontouchstart = (e) => { e.preventDefault(); jump(); };
            function updateL() { let h = ""; for(let i=0; i<lives; i++) h += "â¤ï¸"; ld.innerText = h; } updateL();
            function loop() {
                if(isGameOver) return; ctx.clearRect(0,0,340,240);
                if(frame % 120 === 0) pits.push({x:340, w:60});
                if(frame % 90 === 0 && !pits.some(p => p.x > 300)) obstacles.push({x:340, w:20, h:30});
                ctx.fillStyle = '#795548'; ctx.fillRect(0, 190, 340, 50);
                ctx.fillStyle = '#fff'; let above = false;
                pits.forEach((p, i) => { p.x -= 4; ctx.fillRect(p.x, 190, p.w, 50); if(dino.x+10 < p.x+p.w && dino.x+20 > p.x) above = true; if(p.x+p.w < 0) pits.splice(i,1); });
                dino.dy += 0.6; dino.y += dino.dy;
                if(dino.y >= 160) {
                    if(above) {
                        dino.grounded = false;
                        if(dino.y > 280) { score = Math.max(0, score-10); updateScoreUI(); dino.y=-50; dino.dy=0; inv=90; }
                    } else { dino.y=160; dino.dy=0; dino.grounded=true; }
                }
                ctx.fillStyle = (inv>0 && Math.floor(frame/5)%2) ? 'transparent' : '#4CAF50';
                ctx.fillRect(dino.x, dino.y, 30, 30); ctx.fillRect(dino.x+15, dino.y-10, 20, 20); ctx.fillStyle='black'; ctx.fillRect(dino.x+25, dino.y-5, 4, 4);
                ctx.fillStyle = '#e91e63';
                obstacles.forEach((o, i) => { 
                    o.x -= 4; ctx.fillRect(o.x, 160, o.w, o.h); 
                    if(inv<=0 && dino.x < o.x+o.w && dino.x+30 > o.x && dino.y < 160+o.h && dino.y+30 > 160) { 
                        lives--; updateL(); inv=60; 
                        if (lives <= 0) showGameOverModal(); 
                    } 
                    if(o.x+o.w < 0) { obstacles.splice(i,1); score += 10; updateScoreUI(); } 
                });
                if(inv>0) inv--; frame++; gameInterval = requestAnimationFrame(loop);
            } loop();
        }

        // [ê²Œì„ 3] ğŸŒˆ ë¬´ì§€ê°œ íƒ‘ ìŒ“ê¸°
        function initStackGame() {
            const area = document.getElementById('game-area'), canvas = document.createElement('canvas');
            canvas.width = 300; canvas.height = 400; area.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let stack = [{x:75, w:150, y:370, color:'#333'}], curW = 150, curX = 0, speed = 3, dir = 1, layer = 0, startY = 370;
            function draw() {
                if(isGameOver) return; ctx.clearRect(0,0,300,400);
                stack.forEach(b => { ctx.fillStyle = b.color; ctx.fillRect(b.x, b.y, b.w, 30); });
                ctx.fillStyle = `hsl(${(layer*40)%360}, 80%, 60%)`;
                ctx.fillRect(curX, startY-(layer+1)*30, curW, 30);
                curX += speed*dir; if(curX+curW > 300 || curX < 0) dir *= -1;
                gameInterval = requestAnimationFrame(draw);
            }
            const place = (e) => {
                if(e.type==='touchstart') e.preventDefault();
                let prev = stack[stack.length-1], overlap = Math.min(prev.x+prev.w, curX+curW) - Math.max(prev.x, curX);
                if(overlap > 0) {
                    stack.push({x:Math.max(prev.x, curX), w:overlap, y:startY-(layer+1)*30, color:`hsl(${(layer*40)%360}, 80%, 60%)`});
                    curW = overlap; layer++; score = layer*10; updateScoreUI();
                    if(layer > 7) { stack.forEach(b => b.y += 30); startY += 30; stack.shift(); }
                    speed += 0.2; curX = Math.random() > 0.5 ? 0 : 300-curW;
                } else showGameOverModal();
            };
            canvas.onmousedown = place; canvas.ontouchstart = place; draw();
        }

        // [ê²Œì„ 4] ğŸˆ í’ì„  íŒ¡íŒ¡ (ê°œë³„ í„°ì¹˜ ë¡œì§)
        function initBalloonGame() {
            const timerDisplay = document.getElementById('timer-display');
            timerDisplay.classList.remove('hidden'); timerDisplay.innerText = "60s";
            const area = document.getElementById('game-area'), canvas = document.createElement('canvas');
            canvas.width = 340; canvas.height = 480; area.appendChild(canvas);
            const ctx = canvas.getContext('2d');
            let balloons = [];
            const colors = ['#FF5252', '#FF4081', '#E040FB', '#7C4DFF', '#536DFE', '#448AFF', '#40C4FF', '#18FFFF', '#64FFDA', '#B2FF59', '#EEFF41', '#FFFF00', '#FFD740', '#FFAB40', '#FF6E40'];

            const handleAction = (ex, ey) => {
                const rect = canvas.getBoundingClientRect();
                const mx = (ex - rect.left) * (canvas.width / rect.width);
                const my = (ey - rect.top) * (canvas.height / rect.height);
                for (let i = balloons.length - 1; i >= 0; i--) {
                    const b = balloons[i]; if (b.pop) continue;
                    const dist = Math.sqrt((mx - b.x)**2 + (my - b.y)**2);
                    if (dist < b.r + 15) { b.pop = true; score += Math.floor(70 - b.r); updateScoreUI(); break; }
                }
            };
            canvas.onmousedown = (e) => handleAction(e.clientX, e.clientY);
            canvas.ontouchstart = (e) => { handleAction(e.touches[0].clientX, e.touches[0].clientY); };

            timerId = setInterval(() => { timeLeft--; timerDisplay.innerText = `${timeLeft}s`; if (timeLeft <= 0) showGameOverModal(); }, 1000);

            function loop() {
                if (isGameOver) return;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                if (Math.random() < 0.15) {
                    const r = 15 + Math.random() * 25;
                    balloons.push({ x: r+Math.random()*(340-r*2), y: 500, r: r, color: colors[Math.floor(Math.random()*colors.length)], speed: 2+Math.random()*4, pop: false });
                }
                for (let i = balloons.length - 1; i >= 0; i--) {
                    const b = balloons[i]; b.y -= b.speed;
                    if (!b.pop) {
                        ctx.beginPath(); ctx.fillStyle = b.color; ctx.ellipse(b.x, b.y, b.r * 0.85, b.r, 0, 0, Math.PI * 2); ctx.fill();
                        ctx.beginPath(); ctx.strokeStyle = '#aaa'; ctx.moveTo(b.x, b.y+b.r); ctx.lineTo(b.x, b.y+b.r+15); ctx.stroke();
                    } else {
                        ctx.fillStyle = b.color; ctx.font = "bold 25px Arial"; ctx.fillText("íŒ¡!", b.x - 15, b.y); balloons.splice(i, 1);
                    }
                    if (b.y < -50) balloons.splice(i, 1);
                }
                gameInterval = requestAnimationFrame(loop);
            } loop();
        }
    </script>
</body>
</html>